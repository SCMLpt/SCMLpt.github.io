<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Research Chat - SCMLpt</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #000 0%, #111 100%);
      color: lightblue;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    nav {
      background: linear-gradient(to right, #1a1a1a, #111);
      display: flex; justify-content: center; align-items: center;
      padding: 10px 0; font-size: 1.2em; position: sticky; top: 0; z-index: 10;
    }
    nav a { color: lightblue; text-decoration: none; margin: 0 15px; font-weight: bold; transition: color 0.3s ease; }
    nav a:hover { color: #ff4081; }
    #chatbotContainer {
      width: 80%;
      max-width: 800px;
      margin: 20px auto;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }
    #chatLog {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      text-align: left;
    }
    .message {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 8px;
      max-width: 70%;
    }
    .bot-message { background: #333; color: #fff; align-self: flex-start; }
    .user-message { background: #ff4081; color: #fff; align-self: flex-end; margin-left: auto; }
    #chatInputContainer {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
      background: #111;
      border-top: 1px solid #333;
      gap: 10px;
    }
    #breadcrumb { 
      padding: 10px; 
      color: #ff4081; 
      font-weight: bold; 
      flex-basis: 100%; 
    }
    /* 모든 input/select 요소에 대한 스타일 */
    #searchInput, #searchSelect, #exploreSelect, #actionSelect {
      flex-grow: 1;
      padding: 10px;
      font-size: 1.1em;
      background-color: #222;
      color: lightblue;
      border: 1px solid #444;
      border-radius: 5px;
      outline: none;
    }
    #chatbotSubmit {
      padding: 10px 20px;
      background: #ff4081;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #chatbotSubmit:hover { background: #f50057; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="publications.html">Publications</a>
    <a href="activities.html">Activities</a>
    <a href="philosophy.html">Philosophy</a>
    <a href="contact.html">Contact</a>
  </nav>
  <div id="chatbotContainer">
    <div id="chatLog">
      <div class="message bot-message">Hi! Start by searching topics or exploring deeper into a specific area:</div>
    </div>
    <div id="chatInputContainer">
      <div id="breadcrumb">Path: Root</div>
      <!-- 검색어 필터 입력 -->
      <input type="text" id="searchInput" placeholder="Type to filter topics..." oninput="updateSearchOptions()">
      <!-- 검색 결과 드롭다운 -->
      <select id="searchSelect" onchange="handleSearch()">
        <option value="" disabled selected>Select a topic...</option>
      </select>
      <!-- 현재 노드의 하위 주제 탐색 -->
      <select id="exploreSelect">
        <option value="">Explore further...</option>
      </select>
      <!-- 액션 선택 -->
      <select id="actionSelect">
        <option value="">What do you want to do?</option>
        <option value="papers">Find Recent Papers</option>
        <option value="researchers">Discover Influential Researchers</option>
        <option value="chat">Join Open Chat</option>
        <option value="back">Go Back</option>
      </select>
      <button id="chatbotSubmit" onclick="handleAction()">Go</button>
    </div>
  </div>
  <script>
    // 연구 트리 구조 정의
    const researchTree = {
      name: "Research Areas",
      id: "root",
      children: [
        {
          name: "AI & Machine Learning",
          id: "ai-ml",
          children: [
            { name: "Deep Learning", id: "deep-learning", children: [
                { name: "Convolutional Neural Networks", id: "cnn", children: [
                    { name: "Image Classification", id: "image-classification" }
                ]}
            ]},
            { name: "Natural Language Processing", id: "nlp", children: [
                { name: "Language Models", id: "language-models", children: [
                    { name: "Transformers", id: "transformers" }
                ]}
            ]}
          ]
        },
        {
          name: "Scientific Machine Learning",
          id: "sciml",
          children: [
            { name: "Neural Network Applications", id: "nn-applications", children: [
                { name: "Physics-Informed Neural Networks", id: "pinns", children: [
                    { name: "Fluid Dynamics", id: "fluid-dynamics", children: [
                        { name: "Turbulence Modeling", id: "turbulence", children: [
                            { name: "LES Methods", id: "les-methods" }
                        ]}
                    ]}
                ]}
            ]},
            { name: "Mathematical Modeling", id: "math-modeling", children: [
                { name: "PDE Solving", id: "pde-solving", children: [
                    { name: "Finite Difference Methods", id: "fdm" }
                ]}
            ]}
          ]
        }
      ]
    };

    // 초기 상태: 루트 노드에서 시작
    let currentNode = researchTree;
    let path = [researchTree];

    // 트리를 평탄화하여 모든 주제와 전체 경로를 저장
    let allTopics = [];
    function flattenTree(node, parentPath = []) {
      const currentPath = [...parentPath, node];
      allTopics.push({ name: node.name, id: node.id, path: currentPath });
      if (node.children) {
        node.children.forEach(child => flattenTree(child, currentPath));
      }
    }
    flattenTree(researchTree);

    // 현재 경로를 업데이트
    function updateBreadcrumb() {
      const breadcrumb = document.getElementById("breadcrumb");
      breadcrumb.textContent = "Path: " + path.map(node => node.name).join(" > ");
    }

    // 현재 노드의 자식들로 'Explore further' 옵션 갱신
    function updateExploreSelect() {
      const exploreSelect = document.getElementById("exploreSelect");
      exploreSelect.innerHTML = '<option value="">Explore further...</option>';
      if (currentNode.children && currentNode.children.length > 0) {
        currentNode.children.forEach(child => {
          const option = document.createElement("option");
          option.value = child.id;
          option.textContent = child.name;
          exploreSelect.appendChild(option);
        });
        exploreSelect.style.display = "block";
      } else {
        exploreSelect.style.display = "none";
      }
    }

    // 검색 입력값에 따라 검색 드롭다운 갱신
    function updateSearchOptions() {
      const searchInput = document.getElementById("searchInput").value.toLowerCase();
      const searchSelect = document.getElementById("searchSelect");
      searchSelect.innerHTML = '<option value="" disabled>Select a topic...</option>';
      const filtered = allTopics.filter(topic => 
        topic.name.toLowerCase().includes(searchInput) && topic.id !== "root"
      );
      filtered.forEach(topic => {
        const option = document.createElement("option");
        option.value = topic.id;
        // 전체 경로를 표시하여 선택 시 참고할 수 있게 함
        option.textContent = topic.name + " (" + topic.path.map(n => n.name).join(" > ") + ")";
        searchSelect.appendChild(option);
      });
    }

    // 검색 결과에서 주제를 선택할 때 처리:
    // 만약 선택한 주제가 자식이 있는 중간 노드라면 그대로 경로 업데이트.
    // 만약 선택한 주제가 리프(자식 없음)라면, 부모 노드로 업데이트하여 해당 분기의 다른 옵션도 탐색할 수 있도록 함.
    function handleSearch() {
      const searchSelect = document.getElementById("searchSelect");
      const selectedValue = searchSelect.value;
      if (!selectedValue) return;
      const selectedTopic = allTopics.find(topic => topic.id === selectedValue);
      if (selectedTopic) {
        const chatLog = document.getElementById("chatLog");
        // 선택한 주제가 자식이 있다면 (즉, 세분화 단계가 더 있음)
        if (selectedTopic.path[selectedTopic.path.length - 1].children &&
            selectedTopic.path[selectedTopic.path.length - 1].children.length > 0) {
          currentNode = selectedTopic.path[selectedTopic.path.length - 1];
          path = selectedTopic.path;
          const userMsg = document.createElement("div");
          userMsg.className = "message user-message";
          userMsg.textContent = selectedTopic.name;
          chatLog.appendChild(userMsg);
          const botMsg = document.createElement("div");
          botMsg.className = "message bot-message";
          botMsg.textContent = `Found "${selectedTopic.name}". You can now explore further or select an action.`;
          chatLog.appendChild(botMsg);
        } else {
          // 만약 선택한 주제가 리프 노드라면, 부모 노드로 설정
          if (selectedTopic.path.length > 1) {
            currentNode = selectedTopic.path[selectedTopic.path.length - 2];
            path = selectedTopic.path.slice(0, selectedTopic.path.length - 1);
            const userMsg = document.createElement("div");
            userMsg.className = "message user-message";
            userMsg.textContent = selectedTopic.name;
            chatLog.appendChild(userMsg);
            const botMsg = document.createElement("div");
            botMsg.className = "message bot-message";
            botMsg.textContent = `You selected a final topic "${selectedTopic.name}". Now you're at "${currentNode.name}". To select "${selectedTopic.name}", please choose it from "Explore further".`;
            chatLog.appendChild(botMsg);
          } else {
            // 루트 노드일 경우
            currentNode = selectedTopic.path[selectedTopic.path.length - 1];
            path = selectedTopic.path;
          }
        }
        updateBreadcrumb();
        updateExploreSelect();
        // 초기화: 검색창 클리어 및 드롭다운 리셋
        document.getElementById("searchInput").value = "";
        searchSelect.innerHTML = '<option value="" disabled selected>Select a topic...</option>';
        chatLog.scrollTop = chatLog.scrollHeight;
      }
    }

    // 'Explore further' 및 액션 선택 처리
    function handleAction() {
      const exploreValue = document.getElementById("exploreSelect").value;
      const actionValue = document.getElementById("actionSelect").value;
      const chatLog = document.getElementById("chatLog");

      if (exploreValue) {
        const nextNode = currentNode.children.find(child => child.id === exploreValue);
        if (nextNode) {
          currentNode = nextNode;
          path.push(nextNode);
          const userMsg = document.createElement("div");
          userMsg.className = "message user-message";
          userMsg.textContent = nextNode.name;
          chatLog.appendChild(userMsg);
          const botMsg = document.createElement("div");
          botMsg.className = "message bot-message";
          if (nextNode.children && nextNode.children.length > 0) {
            botMsg.textContent = `Exploring deeper into "${nextNode.name}". Continue exploring or select an action.`;
          } else {
            botMsg.textContent = `Reached "${nextNode.name}". Please select an action.`;
          }
          chatLog.appendChild(botMsg);
        } else {
          const botMsg = document.createElement("div");
          botMsg.className = "message bot-message";
          botMsg.textContent = `No deeper topics found for "${currentNode.name}".`;
          chatLog.appendChild(botMsg);
        }
      } else if (actionValue) {
        const userMsg = document.createElement("div");
        userMsg.className = "message user-message";
        userMsg.textContent = document.getElementById("actionSelect").selectedOptions[0].text;
        chatLog.appendChild(userMsg);
        const botMsg = document.createElement("div");
        botMsg.className = "message bot-message";
        if (actionValue === "papers") {
          botMsg.innerHTML = `Recent papers on "${currentNode.name}": <a href="https://arxiv.org/search/?query=${encodeURIComponent(currentNode.name)}" target="_blank" style="color: #ff4081;">arXiv</a>`;
        } else if (actionValue === "researchers") {
          botMsg.innerHTML = `Search researchers on "${currentNode.name}": <a href="https://scholar.google.com/scholar?q=${encodeURIComponent(currentNode.name)}" target="_blank" style="color: #ff4081;">Google Scholar</a>`;
        } else if (actionValue === "chat") {
          botMsg.innerHTML = `Join chat on "${currentNode.name}": <a href="chatroom.html?room=${currentNode.id}" target="_blank" style="color: #ff4081;">Join</a>`;
        } else if (actionValue === "back") {
          if (path.length > 1) {
            path.pop();
            currentNode = path[path.length - 1];
            botMsg.textContent = `Went back to "${currentNode.name}".`;
          } else {
            botMsg.textContent = "Already at the root.";
          }
        }
        chatLog.appendChild(botMsg);
      }
      updateBreadcrumb();
      updateExploreSelect();
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    // 초기화
    updateBreadcrumb();
    updateExploreSelect();
    updateSearchOptions();
  </script>
</body>
</html>


