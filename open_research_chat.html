<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Research Chat - SCMLpt</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #000 0%, #111 100%);
            color: lightblue;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        nav {
            background: linear-gradient(to right, #1a1a1a, #111);
            display: flex; justify-content: center; align-items: center;
            padding: 10px 0; font-size: 1.2em; position: sticky; top: 0; z-index: 10;
        }
        nav a { color: lightblue; text-decoration: none; margin: 0 15px; font-weight: bold; transition: color 0.3s ease; }
        nav a:hover { color: #ff4081; }

        #chatbotContainer {
            width: 80%;
            max-width: 800px;
            margin: 20px auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: rgba(20, 20, 20, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        #chatLog {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            text-align: left;
        }
        .message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 8px;
            max-width: 70%;
        }
        .bot-message { background: #333; color: #fff; align-self: flex-start; }
        .user-message { background: #ff4081; color: #fff; align-self: flex-end; margin-left: auto; }
        #chatInputContainer {
            display: flex;
            flex-wrap: wrap;
            padding: 10px;
            background: #111;
            border-top: 1px solid #333;
            gap: 10px;
        }
        #breadcrumb { 
            padding: 10px; 
            color: #ff4081; 
            font-weight: bold; 
            flex-basis: 100%; 
        }
        #searchSelect, #topicSelect, #actionSelect {
            flex-grow: 1;
            padding: 10px;
            font-size: 1.1em;
            background-color: #222;
            color: lightblue;
            border: 1px solid #444;
            border-radius: 5px;
            outline: none;
        }
        #chatbotSubmit {
            padding: 10px 20px;
            background: #ff4081;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #chatbotSubmit:hover { background: #f50057; }
        #actionSelect { display: none; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="publications.html">Publications</a>
        <a href="activities.html">Activities</a>
        <a href="philosophy.html">Philosophy</a>
        <a href="contact.html">Contact</a>
    </nav>

    <div id="chatbotContainer">
        <div id="chatLog">
            <div class="message bot-message">Hi! Start by searching a topic or exploring below:</div>
        </div>
        <div id="chatInputContainer">
            <div id="breadcrumb"></div>
            <select id="searchSelect" onchange="handleSearch()">
                <option value="">Search topics (type to filter)...</option>
            </select>
            <select id="topicSelect"></select>
            <select id="actionSelect">
                <option value="">What do you want to do?</option>
                <option value="papers">Find Recent Papers</option>
                <option value="researchers">Discover Influential Researchers</option>
                <option value="chat">Join Open Chat</option>
                <option value="back">Go Back</option>
            </select>
            <button id="chatbotSubmit" onclick="handleInput()">Go</button>
        </div>
    </div>

    <script>
        const researchTree = {
            name: "Research Areas",
            id: "root",
            children: [
                {
                    name: "AI & Machine Learning",
                    id: "ai-ml",
                    children: [
                        { name: "Deep Learning", id: "deep-learning", children: [
                            { name: "Convolutional Neural Networks", id: "cnn", children: [
                                { name: "Image Classification", id: "image-classification" }
                            ] }
                        ] },
                        { name: "Natural Language Processing", id: "nlp", children: [
                            { name: "Language Models", id: "language-models", children: [
                                { name: "Transformers", id: "transformers" }
                            ] }
                        ] }
                    ]
                },
                {
                    name: "Scientific Machine Learning",
                    id: "sciml",
                    children: [
                        { name: "Neural Network Applications", id: "nn-applications", children: [
                            { name: "Physics-Informed Neural Networks", id: "pinns", children: [
                                { name: "Fluid Dynamics", id: "fluid-dynamics", children: [
                                    { name: "Turbulence Modeling", id: "turbulence", children: [
                                        { name: "LES Methods", id: "les-methods" }
                                    ] }
                                ] }
                            ] }
                        ] },
                        { name: "Mathematical Modeling", id: "math-modeling", children: [
                            { name: "PDE Solving", id: "pde-solving", children: [
                                { name: "Finite Difference Methods", id: "fdm" }
                            ] }
                        ] }
                    ]
                }
            ]
        };

        let currentNode = researchTree;
        let path = [];
        let allTopics = [];

        // 트리를 평평하게 만들어 검색용 리스트 생성
        function flattenTree(node, list = []) {
            list.push({ name: node.name, id: node.id, path: buildPath(researchTree, node.id) });
            if (node.children) {
                node.children.forEach(child => flattenTree(child, list));
            }
            return list;
        }

        allTopics = flattenTree(researchTree);

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById("breadcrumb");
            breadcrumb.textContent = path.length > 0 ? "Path: " + path.map(p => p.name).join(" > ") : "Path: Root";
        }

        function updateTopicSelect() {
            const select = document.getElementById("topicSelect");
            select.innerHTML = '<option value="">Explore further...</option>';
            if (currentNode.children) {
                currentNode.children.forEach(child => {
                    const option = document.createElement("option");
                    option.value = child.id;
                    option.textContent = child.name;
                    select.appendChild(option);
                });
            }
            select.style.display = currentNode.children ? "block" : "none";
            document.getElementById("actionSelect").style.display = "block";
        }

        function updateSearchSelect(filter = "") {
            const searchSelect = document.getElementById("searchSelect");
            searchSelect.innerHTML = '<option value="">Search topics...</option>';
            const filtered = allTopics.filter(topic => 
                topic.name.toLowerCase().includes(filter.toLowerCase()) && topic.id !== "root"
            );
            filtered.forEach(topic => {
                const option = document.createElement("option");
                option.value = topic.id;
                option.textContent = `${topic.name} (${topic.path.map(p => p.name).join(" > ")})`;
                searchSelect.appendChild(option);
            });
        }

        function handleSearch() {
            const searchValue = document.getElementById("searchSelect").value;
            if (!searchValue) return;

            const foundNode = allTopics.find(topic => topic.id === searchValue);
            if (foundNode) {
                currentNode = foundNode.path[foundNode.path.length - 1];
                path = foundNode.path;
                const chatLog = document.getElementById("chatLog");
                const userMsg = document.createElement("div");
                userMsg.className = "message user-message";
                userMsg.textContent = foundNode.name;
                chatLog.appendChild(userMsg);
                const botMsg = document.createElement("div");
                botMsg.className = "message bot-message";
                botMsg.textContent = `Found "${foundNode.name}". Explore further or select an action.`;
                chatLog.appendChild(botMsg);
                updateBreadcrumb();
                updateTopicSelect();
                // 선택된 값을 드롭다운에 유지
                document.getElementById("searchSelect").value = searchValue;
            }
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function handleInput() {
            const topicValue = document.getElementById("topicSelect").value;
            const actionValue = document.getElementById("actionSelect").value;
            const chatLog = document.getElementById("chatLog");

            if (topicValue) {
                // 하위 주제로 이동
                const nextNode = currentNode.children.find(child => child.id === topicValue);
                path.push(nextNode);
                currentNode = nextNode;
                const userMsg = document.createElement("div");
                userMsg.className = "message user-message";
                userMsg.textContent = nextNode.name;
                chatLog.appendChild(userMsg);
                const botMsg = document.createElement("div");
                botMsg.className = "message bot-message";
                botMsg.textContent = currentNode.children ? 
                    `Selected "${nextNode.name}". Explore further or choose an action:` : 
                    `Reached "${nextNode.name}". Select an action:`;
                chatLog.appendChild(botMsg);
            } else if (actionValue) {
                // 액션 처리
                const userMsg = document.createElement("div");
                userMsg.className = "message user-message";
                userMsg.textContent = document.getElementById("actionSelect").selectedOptions[0].text;
                chatLog.appendChild(userMsg);
                const botMsg = document.createElement("div");
                botMsg.className = "message bot-message";
                const topic = currentNode.name;
                if (actionValue === "papers") {
                    botMsg.innerHTML = `Recent papers on "${topic}": <a href="https://arxiv.org/search/?query=${encodeURIComponent(topic)}" target="_blank" style="color: #ff4081;">arXiv</a>`;
                } else if (actionValue === "researchers") {
                    botMsg.innerHTML = `Search researchers on "${topic}": <a href="https://scholar.google.com/scholar?q=${encodeURIComponent(topic)}" target="_blank" style="color: #ff4081;">Google Scholar</a>`;
                } else if (actionValue === "chat") {
                    botMsg.innerHTML = `Join chat on "${topic}": <a href="chatroom.html?room=${currentNode.id}" target="_blank" style="color: #ff4081;">Join</a>`;
                } else if (actionValue === "back") {
                    if (path.length > 0) {
                        path.pop();
                        currentNode = path.length > 0 ? path[path.length - 1] : researchTree;
                        botMsg.textContent = `Went back to "${currentNode.name}". Explore or select an action.`;
                    } else {
                        botMsg.textContent = "Already at the root.";
                    }
                }
                chatLog.appendChild(botMsg);
            }

            updateBreadcrumb();
            updateTopicSelect();
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function buildPath(node, targetId) {
            if (node.id === targetId) return [node];
            if (node.children) {
                for (let child of node.children) {
                    const subPath = buildPath(child, targetId);
                    if (subPath) return [node, ...subPath];
                }
            }
            return null;
        }

        // 초기화
        updateBreadcrumb();
        updateTopicSelect();
        updateSearchSelect();

        // 검색 필터링 (입력 시 실시간 업데이트)
        document.getElementById("searchSelect").addEventListener("input", (e) => {
            updateSearchSelect(e.target.value);
        });
    </script>
</body>
</html>
